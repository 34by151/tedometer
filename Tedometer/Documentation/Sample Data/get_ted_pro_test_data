#/bin/bash -x

if [[ "$#" -lt 2 ]]; then
	echo "Usage: $0 <gateway_host> <output_folder>"
	echo
	exit 1
fi

GATEWAY=$1
OUT=$2

mkdir "$OUT"

function write_response() {
	FILE=$1
	OUT_FILE="$OUT/$FILE"
	OUT_FILE=${OUT_FILE/\?/_}
	OUT_FILE=${OUT_FILE//\&/_}
	OUT_FILE=${OUT_FILE//\=/_}
	curl "http://$GATEWAY/api/$FILE" > "$OUT_FILE"
}

write_response "SystemSettings.xml"
write_response "Rate.xml"
write_resposne "SystemOverview.xml"
write_response "DashData.xml?T=0&D=0"
write_response "DashData.xml?T=1&D=0"
for i in 1 2 3 4; do
	write_response "DashData.xml?T=0&D=255&M=$i"
	write_response "DashData.xml?T=1&D=255&M=$i"
done

